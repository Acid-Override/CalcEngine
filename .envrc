# CalcEngine Project Environment Configuration
# This file is loaded automatically by direnv when entering the project directory

# =============================================================================
# Java Configuration
# =============================================================================

# Use Java 21 via SDKMAN! for this project
# Load SDKMAN first, then switch Java version
source "$HOME/.sdkman/bin/sdkman-init.sh"
sdk use java 21.0.8-tem

# Java runtime options for development
export JAVA_TOOL_OPTIONS="-Xmx4g -XX:+UseG1GC -XX:+EnableDynamicAgentLoading"

# Maven configuration
export MAVEN_OPTS="-Xmx2g -XX:+UseG1GC"
export MAVEN_CONFIG="-Dmaven.compiler.source=21 -Dmaven.compiler.target=21"

# =============================================================================
# Application Environment
# =============================================================================

# Development environment
export ENVIRONMENT=development
export LOG_LEVEL=DEBUG

# =============================================================================
# Database Configuration (for PostgreSQL/Hibernate)
# =============================================================================

export DB_HOST=localhost
export DB_PORT=5432
export DB_NAME=demo
export DB_USER=jupiter
export DB_URL="jdbc:postgresql://${DB_HOST}:${DB_PORT}/${DB_NAME}"

# Hibernate settings
export HIBERNATE_DIALECT="org.hibernate.dialect.PostgreSQLDialect"
export HIBERNATE_HBM2DDL_AUTO=update
export HIBERNATE_SHOW_SQL=true

# =============================================================================
# Kafka Configuration
# =============================================================================

export KAFKA_BOOTSTRAP_SERVERS=localhost:9092
export KAFKA_GROUP_ID=calcengine-consumer-group

# =============================================================================
# MongoDB Configuration  
# =============================================================================

export MONGO_HOST=localhost
export MONGO_PORT=27017
export MONGO_DATABASE=calcengine_dev
export MONGO_CONNECTION_STRING="mongodb://${MONGO_HOST}:${MONGO_PORT}/${MONGO_DATABASE}"

# =============================================================================
# Development Tools
# =============================================================================

# Add Maven and project scripts to PATH
PATH_add "./MCalc/target/bin"
PATH_add "./scripts"

# JBang for running Java scripts
PATH_add "$HOME/.jbang/bin"

# =============================================================================
# Project Information
# =============================================================================

echo "🔧 CalcEngine Development Environment Loaded"
echo "   Java: $(java -version 2>&1 | head -1)"
echo "   Maven: $(mvn -version 2>&1 | head -1)"
echo "   Database: PostgreSQL @ ${DB_HOST}:${DB_PORT}/${DB_NAME}"
echo "   Kafka: ${KAFKA_BOOTSTRAP_SERVERS}"
echo "   MongoDB: ${MONGO_CONNECTION_STRING}"
echo ""
echo "📁 Working directory: $(pwd)"
echo "💡 To build: cd MCalc && mvn clean compile"
echo "🧪 To test: cd MCalc && mvn test" 
echo "🐳 To start services: cd docker && docker-compose up"

# Load any project-specific secrets (gitignored)
dotenv_if_exists .env.local